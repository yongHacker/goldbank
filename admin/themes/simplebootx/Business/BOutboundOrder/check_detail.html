<businesstpl file="header" />
<body class="theme-blue" >
<div class="wrap js-check-wrap"  >
	<ul class="nav nav-tabs">
		<li class="active"><a href="{:U('BOutboundOrder/check_detail')}">{:L('BUSINESS_BOUTBOUNDORDER_CHECK_DETAIL')}</a></li>
		<span style="float: right">
            <p  class="btn btn-danger js-ajax-submit" data-type="-2" >驳回</p>
            <p  class="btn btn-primary js-ajax-submit"  data-type="1">审核通过</p>
            <p  class="btn btn-danger js-ajax-submit" data-type="2">审核不通过</p>
            <a class="btn" href="javascript:history.back(-1);">返回</a>
        </span>
	</ul>
	<table class="table table-bordered " style="white-space:normal;">
        <tbody >
        <tr>
            <td style="background-color:#f5f5f5">出库类型</td>
            <td>{$type[$allocation['type']]}</td>
            <td style="background-color:#f5f5f5">状态</td>
            <td style="max-width: 200px;">{$status[$allocation['status']]}</td>
        </tr>
        <tr>
            <td style="background-color:#f5f5f5">开单日期</td>
            <td>{:date('Y-m-d',$allocation['outbound_time'])}</td>
            <td style="background-color:#f5f5f5">出库仓库</td>
            <td  style="max-width: 200px;">{$allocation['out_wh_name']}</td>
        </tr>
        <if condition="$allocation['type'] eq 4">
            <tr>
                <td style="background-color:#f5f5f5">会员</td>
                <td colspan="3">{$allocation['client_name']}({$allocation['client_moblie']})</td>
            </tr>
        </if>
        <tr>
            <td style="background-color:#f5f5f5">开单人</td>
            <td>{$allocation['user_nicename']}</td>
            <td style="background-color:#f5f5f5">备注</td>
            <td  style="max-width: 200px;">{$allocation['memo']}</td>
        </tr>
        <tr>
            <td class="sel">审批备注</td>
            <td colspan="4" style="word-break:break-all;"><textarea  name="check_memo" id="check_memo" rows="2" cols="60" style="width:96%;"></textarea></td>
        </tr>
        </tbody >
	</table>
    <businesstpl file="process" />
	<div class="ta">
		<table class="table table-bordered  table-hover">
			<thead >
			<tr>
				<th>序</th>
                <th>图片</th>
				<th>货品编号</th>
				<th>商品名称</th>
                <th>详情</th>
			</tr>
			</thead>
			<tbody>
			<volist name="list" id="v">
				<tr>
					<td class="text-center"><?php echo ($_GET['p']?($_GET['p']-1)*$numpage+$key+1:$key+1);?></td>
                    <td class="">
                        <if condition="empty($v['product_pic'])">
                            <img src="__TMPL__Public/assets/images/default-thumbnail.png" style="border: 1px solid #ddd;border-radius: 6px;" width="40" />
                            <else />
                            <a href="javascript:parent.image_preview_dialog('{$v['product_pic']}');">
                                <img style="border: 1px solid #ddd;border-radius: 6px;" width="40" src="{$v.product_pic}">
                            </a>
                        </if>
                    </td>
					<td class="text-center"><!--<a href="{:U('BProduct/index',array(search_name=>$v['product_code']))}">-->{$v.product_code}<!--</a>--></td>
					<td>{$v.goods_name}</td>
                    <td style="white-space: normal">{$v.product_detail}</td>
				</tr>
			</volist>
			</tbody>
		</table>
	</div>
	<div class="pagination">{$page}</div>
    <div id="recovery_table" <if condition="$recovery_product_list">class="ta" <else/>class="ta hide"</if>>
        <ul class="nav nav-tabs">
            <li class="active"><a href="javascript:void(0);">金料列表</a></li>
        </ul>
        <table class="table table-bordered  table-hover">
            <thead >
            <tr>
                <th>序</th>
                <th style="width:220px;">关联货号</th>
                <th >金料名称</th>
                <th >金料编号</th>
                <th >金料总重</th>
                <th style="width:220px;">金料金重</th>
                <th >金料金价</th>
                <th >服务克工费</th>
                <th style="width:220px;">纯度(‰)</th>
                <!-- <th style="width:220px;">损耗率</th>-->
                <th >抵扣费用</th>
                <th >材质</th>
                <th >颜色</th>
            </tr>
            </thead>
            <tbody id="tbody" class="recovery_tbody">
            <volist name="recovery_product_list" id="v">
                <tr  class="recovery_type_tr" product_code="{$v.product_code}">
                    <td class="text-center">{$key+1}</td>
                    <td class="text-center product_code">{$v.product_code}</td>
                    <td class="recvery_name">{$v.recovery_name}</td>
                    <td class="text-center rproduct_code">{$v.rproduct_code}</td>
                    <td class="text-right total_weight">{$v.total_weight}</td>
                    <td class="text-right gold_weight">{$v.gold_weight}</td>
                    <td class="text-right recovery_price" >{$v.recovery_price}</td>
                    <td class="text-right service_fee" >{$v.service_fee}</td>
                    <td class="text-center purity" >{$v['purity']}</td>
                    <!--<td class="text-center attrition" ><input type="text" autocomplete="off" name="attrition" value="" placeholder="损耗"></td>-->
                    <td class="text-right cost_price" >{$v.cost_price}</td>
                    <td class=" " >{$v['material']}</td>
                    <td class=" " >{$v['color']}</td>
                </tr>
            </volist>
            </tbody>
        </table>
    </div>
    <businesstpl file="operate" />
    <div class="form-actions text-center">
        <if condition="$info['status'] eq 0">
            <input id="id" type="hidden" name="id" value="{$allocation.id}">
            <p  class="btn btn-danger js-ajax-submit" data-type="-2" >驳回</p>
            <p  class="btn btn-primary js-ajax-submit"  data-type="1">审核通过</p>
            <p  class="btn btn-danger js-ajax-submit" data-type="2">审核不通过</p>
        </if>
        <a class="btn" href="javascript:history.back(-1);">返回</a>
        <span class="tips_error"></span>

    </div>
	<include file="./Application/Home/View/Public/footer.html" />
</div>
<script src="/public/js/cookie.js"></script>
<script src="/public/js/common.js"></script>
<script type="text/javascript">
    $(".js-ajax-submit").on('click',function(){
        var id=$("#id").val();
        var check_memo=$('#check_memo').val();
        var type=$(this).data('type');
        $.ajax({
            url: "{:U('BOutboundOrder/check_post')}",
            type: 'post',
            data:{id:id,check_memo:check_memo,type:type},
            beforeSend:function(){
                $(".js-ajax-submit").attr("disabled",true);
            },
            success: function(data) {
                if(data.status==1){
                    $(".tips_error").text("审核完成！");
                    setTimeout(self.location=data.url,3000);
                }else{
                    $(".tips_error").text(data.msg);
                    $(".js-ajax-submit").attr("disabled",false);
                }
            }

        })
    })
</script>
</body>

