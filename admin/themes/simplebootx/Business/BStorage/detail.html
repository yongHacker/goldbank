<businesstpl file="header" />
<style>
.js-check-wrap>form, .js-check-wrap>form>table { margin-bottom: 10px;}
.my_page { text-align: left;}
.my_page a { position: relative; padding: 6px 12px; margin-left: -1px; line-height: 1.42857143; color: #428bca; text-decoration: none; background-color: #fff; border: 1px solid #ddd;}
.my_page span { position: relative; padding: 6px 12px; margin-left: -1px; line-height: 1.42857143; color: #fff; text-decoration: none; background-color: #6f80a1; border: 1px solid #ddd;}
.my_page li { margin-top: 10px; display: none;}
.table tr th { text-align: center;}
input { width: 163px; margin-bottom: 0px;}
.table { text-overflow: ellipsis; white-space: nowrap; overflow: hidden;}
.ta { overflow-x: auto; width: 100%; margin-bottom: 20px;}
.ta td { position: relative;}
.ta input { width: 177px; margin-bottom: 0px; border: none; border-bottom: 0px; padding: 8px 0; box-shadow: none; border-radius: none; width: 90%; text-align: center;}
.ta input:focus { box-shadow: none; outline: none;}
.ta td { vertical-align: middle;}
.td_border { border: solid 1px #157ab5;}
.select_goods { display: inline-block; background: #fff url('public/images/icon-select.gif') no-repeat scroll 55% 55%; width: 10%; height: 36px; position: absolute; top: 0; right: 0;}
tr td img { width: 200px; height: 60px;}
input.left { text-align: left;}
input.right { text-align: right;}
td.left { text-align: left;}
td.right { text-align: right;}
.myModal { display: block; position: absolute; width: 100%; height: 100%; left: 0; top: 0; line-height: 35px;}
.sel { background: #f4f4f4;}
</style>
<script type="text/javascript" src="__PUBLIC__/lib/datepicker/js/laydate.dev.js"></script>
</head>
<body class=" theme-blue">
	<div class="wrap js-check-wrap">
		<ul class="nav nav-tabs">
			<li class="active"><a href="#">详情</a></li>
			<span style="float: right">
                <if condition='$info.status eq 0 && $info["storage_status"] eq 1 '>
				<a class="btn btn-danger del" href="#myModal" name="{$info.id}" class="del" role="button" data-toggle="modal">撤销</a>
                </if>
				<button class="btn btn-default" onclick="javascript:history.go(-1);">返回</button>
			</span>
		</ul>
		<form id="form" class=" form-search" method="post" action="{:U('BStorage/split')}">
			<input type="hidden" name="id" value="{$info.id}">
            <input type="hidden" name="type" value="{$info.type}">
            <input type="hidden" name="num" value="0">
			<table class="table table-bordered table-hover">
				<tbody>
					<tr>
						<td width="15%">包裹编号</td>
						<td width="35%">{$info.batch}</td>
						<td width="15%">关联订单</td>
						<td width="35%">采购订单({$info.procure_batch})</td>
					</tr>
					<tr>
						<td>包裹种类</td>
						<td>{$info.class_name}<notempty name="info['show_type']">({$info.show_type})</notempty></td>
						<td>包裹金重</td>
						<td>{$info.weight}</td>
					</tr>
					<tr>
						<td>件数</td>
						<td><span id="num">{$info.num}</span></td>
						<td style="line-height: 50px;">包裹状态</td>
						<td style="line-height: 50px;">{$info.show_status}</td>
					</tr>
					<tr>
						<td style="line-height: 50px;">备注</td>
						<td>{$info.memo}</td>
						<td style="line-height: 80px;">审核备注</td>
						<td>{$info.check_memo}</td>
					</tr>
				</tbody>
			</table>
		</form>
		<businesstpl file="process" />
		<div class="main-content">
			<div class="ta">
				<table class="table table-bordered table-hover table-striped">
					<thead>
						<tr>
							<if condition="$info.type eq 1">
							<th class="text-center" width="40">序</th>
							<th class="text-center">规格编码</th>
							<th class="text-center">货品编码</th>
							<th class="text-center">附属货品编码</th>
							<th class="text-center">货品名称</th>
							<th class="text-center">规格</th>
							<th class="text-center">含金量</th>
							<th class="text-center">质检编号</th>
							<th class="text-center">款号</th>
							<th class="text-center">金重</th>
							<th class="text-center">销售工费方式</th>
							<th class="text-center">销售工费</th>
							<th class="text-center">销售一口价</th>
							<th class="text-center">尺寸</th>
							<th class="text-center">证书类型</th>
							<th class="text-center">证书号</th>
							<th class="text-center">证书费</th>
							<th class="text-center">附加费用</th>
							<th class="text-center">调整记录</th>
							</if>
							<!-- <if condition="$info.type eq 2">
							<th class="text-center" width="40">序</th>
							<th class="text-center">规格编码</th>
							<th class="text-center">货品编码</th>
							<th class="text-center">货品名称</th>
							<th class="text-center">金重</th>
							<th class="text-center">折纯克重</th>
                            </if>
							<if condition="$info.type eq 3">
							<th class="text-center" width="40">序</th>
							<th class="text-center">规格编码</th>
							<th class="text-center">货品编码</th>
							<th class="text-center">货品名称</th>
							<th class="text-center">规格</th>
							<th class="text-center">检测号</th>
							<th class="text-center">形状</th>
							<th class="text-center">石重</th>
							<th class="text-center">颜色</th>
							<th class="text-center">净度</th>
							<th class="text-center">切工</th>
							<th class="text-center">荧光</th>
							<th class="text-center">抛光</th>
							<th class="text-center">对称</th>
							<th class="text-center">证书类型</th>
							<th class="text-center">证书号</th>
							</if>
							<if condition="$info.type eq 4">
							<th class="text-center" width="40">序</th>
							<th class="text-center">规格编码</th>
							<th class="text-center">货品编码</th>
							<th class="text-center">货品名称</th>
							<th class="text-center">规格</th>
							<th class="text-center">检测号</th>
							<th class="text-center">款式</th>
							<th class="text-center">材质</th>
							<th class="text-center">材质颜色</th>
							<th class="text-center">尺寸</th>
							<th class="text-center">货重</th>
							<th class="text-center">金重</th>
							<th class="text-center">主石数</th>
							<th class="text-center">主石重</th>
							<th class="text-center">主石颜色</th>
							<th class="text-center">主石净度</th>
							<th class="text-center">主石切工</th>
							<th class="text-center">附石数</th>
							<th class="text-center">附石重</th>
							<th class="text-center">标签价</th>
							<th class="text-center">证书类型</th>
							<th class="text-center">证书号</th>
							</if>
							<if condition="$info.type eq 5">
							<th class="text-center" width="40">序</th>
							<th class="text-center">规格编码</th>
							<th class="text-center">货品编码</th>
							<th class="text-center">货品名称</th>
							<th class="text-center">规格</th>
							<th class="text-center">检测号</th>
							<th class="text-center">尺寸</th>
							<th class="text-center">货重</th>
							<th class="text-center">主石数</th>
							<th class="text-center">主石重</th>
							<th class="text-center">标签价</th>
							<th class="text-center">证书类型</th>
							<th class="text-center">证书号</th>
							</if>
							<if condition="$info.type eq 6">
							<th class="text-center" width="40">序</th>
							<th class="text-center">规格编码</th>
							<th class="text-center">货品编码</th>
							<th class="text-center">货品名称</th>
							<th class="text-center">规格</th>
							<th class="text-center">标签价</th>
							</if> -->
						</tr>
					</thead>
					<tbody id="tbody">
						<volist name="product_list" id="v">
                            <if condition="$info.type eq 1">
						        <tr id="{$v.goods_id}" goods_code="{$v.goods_code}" data-pid="{$v.pid}">
									<td class="text-center">{$key+1}</td>
									<td class="text-center">{$v.goods_code}</td>
									<td class="text-center">{$v.product_code}</td>
									<td class="text-center">{$v.sub_product_code}</td>
									<td class="text-left">{$v.goods_name}</td>
									<td class="text-left">{$v.goods_spec}</td>
									<td class="text-right">{$v.purity}</td>
									<td class="text-center">{$v.qc_code}</td>
									<td class="text-center">{$v.design}</td>
									<td class="text-right weight">{$v.weight}</td>
									<td class="text-center"><if condition="$v.sell_feemode eq 1">克工费销售<else />件工费销售</if></td>
									<td class="text-right sell_fee">{$v.sell_fee}</td>
									<td class="text-right sell_price">{$v.sell_price}</td>
									<td class="text-right">{$v.ring_size}</td>
									<td class="text-center">{$v.certify_type}</td>
									<td class="text-center">{$v.certify_code}</td>
									<td class="text-right">{$v.certify_price}</td>
									<td class="text-right">{$v.extras}</td>
									<td class="text-center"><empty name="v['adjust_count']">-<else /><a href="{:U('BAdjust/product_record', array('product_code' => $v['product_code']))}">详情</a></empty></td>
								</tr>
								<notempty name="v['memo']">
									<tr>
										<td class="text-center">备注</td>
										<td colspan="16">{$v.memo}</td>
									</tr>
								</notempty>
						    </if>
                            <!-- <if condition="$info.type eq 2">
						        <tr id="{$v.goods_id}" goods_code="{$v.goods_code}" data-pid="{$v.pid}">
									<td class="text-center">{$key+1}</td>
									<td class="text-center">{$v.goods_code}</td>
									<td class="text-center"><input class="product_code" type="text" style="padding: 5px 3px;" value="{$v.product_code}"></td>
									<td class="text-left">{$v.goods_name}</td>
									<td class="text-right weight">{$v.weight}</td>
									<td class="text-right">{$v.d_weight}</td>
								</tr>
								<notempty name="v['memo']">
									<tr>
										<td class="text-center">备注</td>
										<td colspan="5">{$v.memo}</td>
									</tr>
								</notempty>
						    </if>
							<if condition="$info.type eq 3">
						        <tr id="{$v.goods_id}" goods_code="{$v.goods_code}" data-pid="{$v.pid}">
									<td class="text-center">{$key+1}</td>
									<td class="text-center">{$v.goods_code}</td>
									<td class="text-center">{$v.product_code}</td>
									<td class="text-left">{$v.goods_name}</td>
									<td class="text-left">{$v.goods_spec}</td>
									<td class="text-center">{$v.qc_code}</td>
									<td class="text-center">{$v.shape}</td>
									<td class="text-right">{$v.caratage}</td>
									<td class="text-center">{$v.color}</td>
									<td class="text-center">{$v.clarity}</td>
									<td class="text-center">{$v.cut}</td>
									<td class="text-center">{$v.fluorescent}</td>
									<td class="text-center">{$v.polish}</td>
									<td class="text-center">{$v.symmetric}</td>
									<td class="text-center">{$v.certify_type}</td>
									<td class="text-center">{$v.certify_code}</td>
								</tr>
								<notempty name="v['memo']">
									<tr>
										<td class="text-center">备注</td>
										<td colspan="15">{$v.memo}</td>
									</tr>
								</notempty>
						    </if>
                            <if condition="$info.type eq 4">
						        <tr id="{$v.goods_id}" goods_code="{$v.goods_code}" data-pid="{$v.pid}">
									<td class="text-center">{$key+1}</td>
									<td class="text-center">{$v.goods_code}</td>
									<td class="text-center">{$v.product_code}</td>
									<td class="text-left">{$v.goods_name}</td>
									<td class="text-left">{$v.goods_spec}</td>
									<td class="text-center">{$v.qc_code}</td>
									<td class="text-center">{$v.design}</td>
									<td class="text-center">{$v.material}</td>
									<td class="text-center">{$v.material_color}</td>
									<td class="text-right">{$v.ring_size}</td>
									<td class="text-right">{$v.total_weight}</td>
									<td class="text-right">{$v.gold_weight}</td>
									<td class="text-right">{$v.main_stone_num}</td>
									<td class="text-center">{$v.main_stone_caratage}</td>
									<td class="text-center">{$v.color}</td>
									<td class="text-center">{$v.clarity}</td>
									<td class="text-center">{$v.cut}</td>
									<td class="text-right">{$v.side_stone_num}</td>
									<td class="text-center">{$v.side_stone_caratage}</td>
									<td class="text-right">{$v.sell_price}</td>
									<td class="text-center">{$v.certify_type}</td>
									<td class="text-center">{$v.certify_code}</td>
								</tr>
								<notempty name="v['memo']">
									<tr>
										<td class="text-center">备注</td>
										<td colspan="22">{$v.memo}</td>
									</tr>
								</notempty>
						    </if>
                            <if condition="$info.type eq 5">
						        <tr id="{$v.goods_id}" goods_code="{$v.goods_code}" data-pid="{$v.pid}">
									<td class="text-center">{$key+1}</td>
									<td class="text-center">{$v.goods_code}</td>
									<td class="text-center">{$v.product_code}</td>
									<td class="text-left">{$v.goods_name}</td>
									<td class="text-left">{$v.goods_spec}</td>
									<td class="text-center">{$v.qc_code}</td>
									<td class="text-right">{$v.ring_size}</td>
									<td class="text-right">{$v.p_weight}</td>
									<td class="text-right">{$v.stone_num}</td>
									<td class="text-right">{$v.stone_weight}</td>
									<td class="text-right">{$v.sell_price}</td>
									<td class="text-center">{$v.certify_type}</td>
									<td class="text-center">{$v.certify_code}</td>
								</tr>
								<notempty name="v['memo']">
									<tr>
										<td class="text-center">备注</td>
										<td colspan="12">{$v.memo}</td>
									</tr>
								</notempty>
						    </if>
                            <if condition="$info.type eq 6">
						        <tr id="{$v.goods_id}" goods_code="{$v.goods_code}" data-pid="{$v.pid}">
									<td class="text-center">{$key+1}</td>
									<td class="text-center">{$v.goods_code}</td>
									<td class="text-center">{$v.product_code}</td>
									<td class="text-left">{$v.goods_name}</td>
									<td class="text-left">{$v.goods_spec}</td>
									<td class="text-right">{$v.sell_price}</td>
								</tr>
								<notempty name="v['memo']">
									<tr>
										<td class="text-center">备注</td>
										<td colspan="5">{$v.memo}</td>
									</tr>
								</notempty>
						    </if> -->
                        </volist>
					</tbody>
				</table>
			</div>
			<div>
				本次分称共{:count($product_list)}件，克重<span id="real_weight">0.00</span>g，称差
				<if condition="$info['diff_weight'] neq '0.00'"> <span class="text-error">{$info.diff_weight} g</span> <else /> 0 g </if>
				<input type="hidden" name="real_weight" value="0.00"> <input type="hidden" name="num" value="0">
			</div>
		</div>

		<businesstpl file="operate" />
		
		<div class="form-actions text-center">
			<if condition='$info.status eq 0 && $info["storage_status"] eq 1 '>
			<a class="btn btn-danger del" href="#myModal" name="{$info.id}" class="del" role="button" data-toggle="modal">撤销</a> </if>
			<button class="btn btn-default" onclick="javascript:history.go(-1);">返回</button>
		</div>
	</div>

	<div class="modal small fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog-div">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					<h3 id="myModalLabel">取消警告</h3>
				</div>
				<div class="modal-body">
					<p class="error-text">
						<i class="fa fa-warning modal-icon"></i>你确定要撤销吗?
					</p>
				</div>
				<div class="modal-footer">
					<button id="cancel" class="btn btn-default" data-dismiss="modal" aria-hidden="true">返回</button>
					<button id="del" class="btn btn-danger" data-dismiss="modal">确定</button>
				</div>
			</div>
		</div>
	</div>
	<script src="__PUBLIC__/lib/bootstrap/js/tree.js"></script>
	<script src="__PUBLIC__/js/jquery-ui.min.js"></script>
	<script src="__PUBLIC__/js/jquery-form.js"></script>
	<script src="__PUBLIC__/js/cookie.js"></script>
	<script src="__PUBLIC__/js/common.js"></script>

	<script>
		$(function() {
			setUser();
		});
		function setUser() {
			$(".del").each(function(index, obj) {
				$(this).unbind().click(function() {
					var id = $(this).attr('name');
					delUser(id);
				})
			});
		}
		function delUser(id) {
			$('#myModal').find('button').each(function(index, element) {
				$(this).unbind().click(function() {
					if ($(this).attr('id') == 'del') {
						$.ajax({
							url : "{:U('BStorage/detail')}",
							type : 'post',
							data : {
								id : id
							},
							success : function(data) {
								if (data.status == 1) {
									self.location = document.referrer;
								} else {
									alert(data.msg);
								}
							}
						})
					}
				})
			});
		}

		count_num();

		count_weight();

		function count_num() {
			/* var total_num = parseInt($('.ta tbody tr').size());
			$('#num').text(total_num);
			$('input[name=num]').val(total_num); */
		}

		function count_weight() {
			var total_weight = 0;

			$('.ta tbody tr').each(function() {
				var w = parseFloat($(this).find('.weight').val()) > 0 ? parseFloat($(this).find('.weight').val()) : parseFloat($(this).find('.weight').html());
				if (w > 0) {
					total_weight += w;
				}
			});

			total_weight = total_weight.toFixed(2);

			setInputValue('real_weight', total_weight);

			setShowText($('#real_weight'), total_weight);

			return total_weight;
		}

		function setShowText(obj, total_weight) {
			$(obj).text(total_weight);
		}

		function setInputValue(inputName, inputValue) {
			if ($('input[name="' + inputName + '"]')[0] != undefined) {
				$('input[name="' + inputName + '"]').val(inputValue);
			}
		}
	</script>
	<include file="./Application/Home/View/Public/footer.html" />